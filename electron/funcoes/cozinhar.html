<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" id="diretorio" href="../css/recursividade.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../sweetalert/sweetalert.js"></script>
    <script src="../telaInicial/dialogos.js"></script>
    <title>Document</title>
</head>

<body>
    <audio id="audio" src="../sounds/lavar_cozinhar.mp3" loop autoplay></audio>


    <div class="campo">



        <div class="cherrim" style="display: block">
            <img class="cherrim" id="cherrim" src="../img/recursividade/m1.gif">
        </div>

        <div class="Weezing">
            <img class="Weezing" id="Weezing" style="display: none;" src="../img/recursividade/m2.gif">
        </div>

 


        <div>
            <div class="grimer">
                <img class="grimer" id="grimer" style="display: none;" src="../img/recursividade/m3.gif">
            </div>
        </div>



        <div>
            <img class="ingrediente" id="ingrediente" src="../img/recursividade/receita/1.png">
        </div>


        <div class="teleport">
            <img id="teleport1" style="display: none" src="../img/recursividade/teleport.gif">
            <img id="teleport2" style="display: none" src="../img/recursividade/teleport.gif">
            <img id="teleport3" style="display: none" src="../img/recursividade/teleport.gif">
        </div>

        <div class="porta0">
            <img class="porta0" src="../img/recursividade/porta_aberta2.png">
        </div>





        <div class="portaAberta1">
            <img class="portaAberta1" id="portaAberta1" src="../img/recursividade/alien.gif">
        </div>

        <div class="portaAberta2">
            <img class="portaAberta2" id="portaAberta2" src="../img/recursividade/alien2.gif">
        </div>

        <div class="portaAberta3">
            <img class="portaAberta3" id="portaAberta3" src="../img/recursividade/alien2.gif">
        </div>

        <div class="chao1">
            <img class="bloco1" src="../img/recursividade/chao.jpg">
        </div>
        <div class="chao2">
            <img class="bloco2" src="../img/recursividade/chao.jpg">
        </div>
        <div class="chao3">
            <img class="bloco3" src="../img/recursividade/chao.jpg">
        </div>
        <div class="chao4">
            <img class="bloco4" src="../img/recursividade/chao.jpg">
        </div>
        <div class="chao5">
            <img class="bloco5" src="../img/recursividade/chao.jpg">
        </div>

        <div class="escadas">
            <div class="escada1" id="1">
                <img class="escada1" id="escada1" src="../img/recursividade/escada.png">
            </div>
            <div class="escada2" id="2">
                <img class="escada2" id="escada2" src="../img/recursividade/escada.png">
            </div>

            <div class="escada3" id="3">
                <img class="escada3" id="escada3" src="../img/recursividade/escada.png">
            </div>
            <div class="escada4" id="4">
                <img class="escada4" id="escada4" src="../img/recursividade/escada.png">
            </div>

            <div class="escada5" id="5">
                <img class="escada5" id="escada5" src="../img/recursividade/escada.png">
            </div>
        </div>




        <div class="personagem">
            <img class="personagem" id="personagem" src="../img/recursividade/cortar/tartaruga.gif">
        </div>


        <div>
            <img class="mesa" id="mesa" src="../img/recursividade/mesa1.png">
        </div>

        <div>
            <img class="geladeira" id="geladeira" src="../img/recursividade/geladeira.png">
        </div>

        <div>
            <img class="fogao" id="fogao" src="../img/recursividade/fogao.png">
        </div>

        <div>
            <img class="pia" id="pia" src="../img/recursividade/pia.png">
        </div>

        <div>
            <img class="escorredor" id="escorredor" src="../img/recursividade/lavadeira.png">
        </div>

        <div>
            <img class="mesaFlor" id="mesaFlor" src="../img/recursividade/mesa2.png">
        </div>

        <div>
            <img class="mesaJantar" id="mesaJantar" src="../img/recursividade/armario.png">
        </div>

        <div>
            <img class="lampada1" id="lampada1" src="../img/recursividade/lampada.png">
        </div>


        <div>
            <img class="lampada3" id="lampada3" src="../img/recursividade/lampada.png">
        </div>

        <div>
            <img class="lampada4" id="lampada3" src="../img/recursividade/lampada.png">
        </div>

        <div>
            <div class="quadro">
                <img src="../img/recursividade/usina.png">
            </div>
        </div>




        <div class="wall" style="opacity: 0.1;"></div>

        <div>
            <h3 id="textoIngredientes">Ingredientes Bolo</h3>
            <h3 id="textoIngredientes2">Ingredientes Pizza</h3>

            <div class="receitaBolo">
                <div class="bolo" id="c1">
                    <img src="../img/recursividade/receita/1.png"></img>
                </div>
                <div class="bolo" id="c2">
                    <img src="../img/recursividade/receita/3.png"></img>
                </div>
                <div class="bolo" id="c3">
                    <img src="../img/recursividade/receita/5.png"></img>
                </div>
                <div class="bolo" id="c4">
                    <img src="../img/recursividade/receita/7.png"></img>
                </div>
                <div class="bolo" id="c5">
                    <img src="../img/recursividade/receita/9.png"></img>
                </div>
            </div>


            <div class="receitaPizza">
                <div class="pizza" id="p1">
                    <img src="../img/recursividade/receita/2.png"></img>
                </div>
                <div class="pizza" id="p2">
                    <img src="../img/recursividade/receita/4.png"></img>
                </div>
                <div class="pizza" id="p3">
                    <img src="../img/recursividade/receita/6.png"></img>
                </div>
                <div class="pizza" id="p4">
                    <img src="../img/recursividade/receita/8.png"></img>
                </div>
            </div>
        </div>




        <div class="vidas">
            <div class="vidas1">
                <img src="../img/recursividade/cortar/vida.png"></img>
            </div>
            <div class="vidas2">
                <img src="../img/recursividade/cortar/vida.png"></img>
            </div>
            <div class="vidas3">
                <img src="../img/recursividade/cortar/vida.png"></img>
            </div>
        </div>



    </div>



    <script>

        var wall = document.querySelector(".wall");  //definicao de variavel e laco for para projetar as ceramicas da cozinha

        for (var i = 0; i < 100; i++) {
            var tile = document.createElement("div");
            tile.className = "tile";
            wall.appendChild(tile);
        }

        //variaveis necessarias para definir contadores de ingredientes e vidas
        var contadorBolo = 1;
        var contadorPizza = 1;
        var atualiza = 1;
        var vidas = 3;

        const alteraVida = () => { //altera a quantidade de vidas restantes para o jogador
            if (vidas == 3) {
                document.querySelector(".vidas3").remove();
                vidas = vidas - 1;
            } else if (vidas == 2) {
                document.querySelector(".vidas2").remove();
                vidas = vidas - 1;
                document.querySelector('.vida').style.animationPlayState = 'running';
                document.querySelector('.vida2').style.animationPlayState = 'running';
            } else if (vidas == 1) {
                document.querySelector(".vidas1").remove();
                vidas = vidas - 1;
            } else if (vidas == 0) {

                exibeNotificação("error", "Você perdeu todas as vidas! Clique para tentar novamente!!", './cozinhar.html');
            }
        }

        const loop = setInterval(() => { //loop para detectar colisoes e realizar operacoes

            var scorbunny = document.getElementById("personagem");
            scorbunny.getBoundingClientRect();

            //estrutura para detectar colisao com inimigos
            if ((scorbunny.x < cherrim.x + cherrim.width && scorbunny.x + scorbunny.width > cherrim.x && scorbunny.y < cherrim.y + cherrim.height && scorbunny.y + scorbunny.height > cherrim.y)) {
                personagem.style.bottom = "1%";
                personagem.style.left = "0%";
                valor = "livre";
                alteraVida();
            }


            if ((scorbunny.x < grimer.x + grimer.width && scorbunny.x + scorbunny.width > grimer.x && scorbunny.y < grimer.y + grimer.height && scorbunny.y + scorbunny.height > grimer.y)) {
                personagem.style.bottom = "1%";
                personagem.style.left = "0%";
                valor = "livre";
                alteraVida();
            }

            if ((scorbunny.x < Weezing.x + Weezing.width && scorbunny.x + scorbunny.width > Weezing.x && scorbunny.y < Weezing.y + Weezing.height && scorbunny.y + scorbunny.height > Weezing.y)) {
                personagem.style.bottom = "1%";
                personagem.style.left = "0%";
                valor = "livre";
                alteraVida();
            }

            //estrutura para detectar colisao com alimentos e bloquear e desbloquear novos inimigos 
            if ((scorbunny.x < ingrediente.x + ingrediente.width && scorbunny.x + scorbunny.width > ingrediente.x && scorbunny.y < ingrediente.y + ingrediente.height && scorbunny.y + scorbunny.height > ingrediente.y)) {

                if (atualiza == 9) {
                    scorbunny.style.display = "none";

                    exibeNotificação("success", "Você Coletou Todos os Ingredientes! Vamos a Proxima Tarefa!", './funcoes.html');
                }
                if ((ingrediente.src).includes("2.png") || (ingrediente.src).includes("4.png") || (ingrediente.src).includes("6.png") || (ingrediente.src).includes("8.png")) {
                    document.getElementById("p" + (contadorPizza)).style.backgroundColor = "green";
                    alteraAlimentos(0);
                } else {
                    document.getElementById("c" + contadorBolo).style.backgroundColor = "green";
                    alteraAlimentos(1);
                }
                if (contadorBolo == 3) {
                    document.getElementById("Weezing").style.display = "block";
                    document.querySelector(".Weezing").style.animationPlayState = "running";
                } else if (contadorBolo == 4) {
                    document.getElementById("grimer").style.display = "block";
                    document.querySelector(".grimer").style.animationPlayState = "running";
                }

            }
        }, 5);


        const alteraAlimentos = (num) => {  //funcao para alterar a posicao dos alimentos de forma aleatoria

            if (contadorBolo == 9) {
                contadorBolo = 0;
            };

            document.getElementById("ingrediente").src = "../img/recursividade/receita/" + (atualiza + 1) + ".png";

            var locais = [
                { x: 20, y: 20 }, { x: 40, y: 20 }, { x: 60, y: 20 }, { x: 80, y: 20 },// pontos parte 1
                { x: 25, y: 45 }, { x: 35, y: 45 }, { x: 65, y: 45 }, { x: 75, y: 45 }, // pontos parte 2
                { x: 20, y: 74 }, { x: 30, y: 74 }, { x: 55, y: 74 }, { x: 70, y: 74 }, // pontos parte 3
                { x: 30, y: 90 }, { x: 55, y: 90 }, { x: 80, y: 90 }  // pontos párte 4
            ];

            var pontoEscolhido = locais[Math.floor(Math.random() * locais.length)];
            ingrediente.style.left = pontoEscolhido.x + '%';
            ingrediente.style.top = pontoEscolhido.y + '%';

            if (num == 0) {
                contadorPizza = contadorPizza + 1;
            } else {
                contadorBolo = contadorBolo + 1;
            }
            atualiza = atualiza + 1;
        }

        valor = "livre";

        //funcoes para realizar movimentacao de personagem



        const moverDireita = () => {
            document.getElementById("personagem").style.transform = "scaleX(1)";

            const el = document.querySelector('.personagem');
            const value = getComputedStyle(el).getPropertyValue('left');
            var remove_string = value.replace('px', '');
            var valorNum = parseInt(remove_string);
            var numPx = valorNum + 10;
            var soma = parseInt(value) + 20;
            personagem.style.left = soma + "px";

        }

        const moverEsquerda = () => {
            if ((personagem.offsetLeft >= 0)) {

                document.getElementById("personagem").style.transform = "scaleX(-1)";
                const el = document.querySelector('.personagem');
                const value = getComputedStyle(el).getPropertyValue('left');
                var remove_string = value.replace('px', '');
                var valorNum = parseInt(remove_string);
                var numPx = valorNum + 10;
                var soma = parseInt(value) - 20;
                personagem.style.left = soma + "px";
            }
        }

        const moverCima = () => {
            // document.getElementById("personagem").src = "../img/recursividade/1_cima.png";
            const el = document.querySelector('.personagem');
            const value = getComputedStyle(el).getPropertyValue('bottom');
            var remove_string = value.replace('px', '');
            var valorNum = parseInt(remove_string);
            var numPx = valorNum + 10;
            var soma = parseInt(value) + 20;
            personagem.style.bottom = soma + "px";
        }


        const personagem = document.querySelector('.personagem');


        const mover = () => {

            //variaveis para capturar tecla e elementos presentes no cenario
            var tecla = event.keyCode;
            var chao = document.querySelector('.bloco4');
            var per = document.getElementById("personagem");
            var escadas = document.querySelectorAll("#escada1, #escada2, #escada3, #escada4, #escada5");

            for (var i = 0; i < escadas.length; i++) { //pega referencia da localizacao das escadas
                escadas[i].getBoundingClientRect();
            }

            //acessa os atributos das portas de teletransporte
            var portaAberta1 = document.getElementById("portaAberta1");
            var portaAberta2 = document.getElementById("portaAberta2");
            var portaAberta3 = document.getElementById("portaAberta3");

            per.getBoundingClientRect();
            portaAberta1.getBoundingClientRect();
            portaAberta2.getBoundingClientRect();
            portaAberta3.getBoundingClientRect();


            //verifica colisao com as portas de teletransporte e realiza a movimentacao do personagem
            if ((per.x < portaAberta1.x + portaAberta1.width && per.x + per.width > portaAberta1.x && per.y < portaAberta1.y + portaAberta1.height && per.y + per.height > portaAberta1.y) || (per.x < portaAberta2.x + portaAberta2.width && per.x + per.width > portaAberta2.x && per.y < portaAberta2.y + portaAberta2.height && per.y + per.height > portaAberta2.y) || (per.x < portaAberta3.x + portaAberta3.width && per.x + per.width > portaAberta3.x && per.y < portaAberta3.y + portaAberta3.height && per.y + per.height > portaAberta3.y)) {

                if (per.x + 100 > portaAberta2.x && per.x < 500) {
                    var teleport = "teleport1";
                } else if (per.x > portaAberta2.x) {
                    var teleport = "teleport3";
                }

                setTimeout(function () {
                    personagem.style.bottom = "1%";
                    personagem.style.left = "0%";
                    document.getElementById("teleport2").style.display = 'block';
                    document.getElementById(teleport).style.display = 'block';
                }, 500);

                setTimeout(function () {
                    document.getElementById("teleport2").style.display = 'none';
                    document.getElementById(teleport).style.display = 'none';
                }, 1000);
            }

            if (tecla == 39 && valor == "livre") {
                moverDireita();
            } else if (tecla == 37 && valor == "livre") {
                moverEsquerda();
            }

            else if (tecla == 38) { //realiza movimentacao para cima, caso esteja em cima de uma escada

                for (var i = 0; i < escadas.length; i++) {

                    if ((per.x + 30 < escadas[i].x + escadas[i].width && per.x - 30 + per.width > escadas[i].x) && (per.y < escadas[i].y + (-10) + escadas[i].height && per.y - (-10) + per.height > escadas[i].y)) {
                        valor = "bloqueado";
                        moverCima();
                    }

                    if (per.y + per.height <= escadas[i].y) {
                        valor = "livre";
                    }
                }
            }
        }

        document.addEventListener('keydown', mover); //detecta movimentacao, via clique de teclas

        const voltar_menu = () => { //tecla de atalho para voltar ao menu de fases
            var tecla = event.keyCode;

            if (tecla == 27) {
                window.location.href = '../telaInicial/city.html';
            }
        }
        document.addEventListener('keydown', voltar_menu);

    </script>
</body>

</html>
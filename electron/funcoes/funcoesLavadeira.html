<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" id="diretorio" href="../css/funcoes4.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../sweetalert/sweetalert.js"></script>
    <script src="../telaInicial/dialogos.js"></script>
    <title>Document</title>
</head>

<body>

    <audio id="audio" src="../sounds/lavar_cozinhar.mp3" loop autoplay></audio>

    <div class="campo">

        <div class="m7">
            <img class="m7" id="m7" style="display: block" src="../img/recursividade/m7.gif">
        </div>

        <div class="m8">
            <img class="m8" id="m8" style="display: block" src="../img/recursividade/m8.gif">
        </div>


        <div class="m6">
            <img class="m6" id="m6" style="display: block;" src="../img/recursividade/m6.gif">
        </div>


        <div>
            <img class="roupa" id="roupa" src="../img/recursividade/lavar/1.png">
        </div>


        <div class="teleport">
            <img id="teleport1" style="display: none" src="../img/recursividade/teleport.gif">
            <img id="teleport2" style="display: none" src="../img/recursividade/teleport.gif">
            <img id="teleport3" style="display: none" src="../img/recursividade/teleport.gif">
        </div>

        <div class="porta0">
            <img class="porta0" src="../img/recursividade/porta_aberta2.png">
        </div>





        <div class="portaAberta1">
            <img class="portaAberta1" id="portaAberta1" src="../img/recursividade/alien.gif">
        </div>

        <div class="portaAberta2">
            <img class="portaAberta2" id="portaAberta2" src="../img/recursividade/alien2.gif">
        </div>

        <div class="portaAberta3">
            <img class="portaAberta3" id="portaAberta3" src="../img/recursividade/alien2.gif">
        </div>

        <div class="chao1">
            <img class="bloco1" src="../img/recursividade/chao.jpg">
        </div>
        <div class="chao2">
            <img class="bloco2" src="../img/recursividade/chao.jpg">
        </div>
        <div class="chao3">
            <img class="bloco3" src="../img/recursividade/chao.jpg">
        </div>
        <div class="chao4">
            <img class="bloco4" src="../img/recursividade/chao.jpg">
        </div>
        <div class="chao5">
            <img class="bloco5" src="../img/recursividade/chao.jpg">
        </div>

        <div class="escadas">
            <div class="escada1" id="1">
                <img class="escada1" id="escada1" ondragover="areaColisao(event)" src="../img/recursividade/escada.png">
            </div>
            <div class="escada2" id="2">
                <img class="escada2" id="escada2" ondragover="areaColisao(event)" src="../img/recursividade/escada.png">
            </div>

            <div class="escada3" id="3">
                <img class="escada3" id="escada3" ondragover="areaColisao(event)" src="../img/recursividade/escada.png">
            </div>
            <div class="escada4" id="4">
                <img class="escada4" id="escada4" ondragover="areaColisao(event)" src="../img/recursividade/escada.png">
            </div>

            <div class="escada5" id="5">
                <img class="escada5" id="escada5" ondragover="areaColisao(event)" src="../img/recursividade/escada.png">
            </div>
        </div>




        <div class="personagem">
            <img class="personagem" id="personagem" ondragstart="personagemIniciado(event)"
                src="../img/recursividade/cortar/tartaruga.gif">
        </div>


        <div>
            <img class="tanque" id="tanque" src="../img/recursividade/lavar/tanque.png">
        </div>

        <div>
            <img class="maquina" id="maquina" src="../img/recursividade/lavar/maquina.png">
        </div>

        <div>
            <img class="cesto" id="cesto" src="../img/recursividade/lavar/cesto.png">
        </div>

        <div>
            <img class="limpeza" id="limpeza" src="../img/recursividade/lavar/limpeza.png">
        </div>

        <div>
            <img class="escorredor" id="escorredor" src="../img/recursividade/lavar/cesto2.png">
        </div>

        <div>
            <img class="cesto3" id="cesto3" src="../img/recursividade/lavar/cesto3.png">
        </div>

        <div>
            <img class="limpeza2" id="limpeza2" src="../img/recursividade/lavar/limpeza2.png">
        </div>

        <div>
            <img class="lampada1" id="lampada1" src="../img/recursividade/lampada.png">
        </div>


        <div>
            <img class="lampada3" id="lampada3" src="../img/recursividade/lampada.png">
        </div>

        <div>
            <img class="lampada4" id="lampada3" src="../img/recursividade/lampada.png">
        </div>

        <div>
            <div class="quadro">
                <img src="../img/recursividade/usina.png">
            </div>
        </div>




        <div class="wall" style="opacity: 0.1;"></div>

        <div>
            <h3 id="textoRoupa1">Vestidos</h3>
            <h3 id="textoRoupa2">Sapatos</h3>
            <h3 id="textoRoupa3">Camisas</h3>
        </div>

        <div class="camisas">
            <div class="camisa" id="b1">
                <img src="../img/recursividade/lavar/1.png"></img>
            </div>
            <div class="camisa" id="b2">
                <img src="../img/recursividade/lavar/4.png"></img>
            </div>
            <div class="camisa" id="b3">
                <img src="../img/recursividade/lavar/7.png"></img>
            </div>
        </div>


        <div class="sapatos">
            <div class="sapato" id="s1">
                <img src="../img/recursividade/lavar/2.png"></img>
            </div>
            <div class="sapato" id="s2">
                <img src="../img/recursividade/lavar/5.png"></img>
            </div>
            <div class="sapato" id="s3">
                <img src="../img/recursividade/lavar/8.png"></img>
            </div>
        </div>


        <div class="vestidos">
            <div class="vestido" id="v1">
                <img src="../img/recursividade/lavar/3.png"></img>
            </div>
            <div class="vestido" id="v2">
                <img src="../img/recursividade/lavar/6.png"></img>
            </div>
            <div class="vestido" id="v3">
                <img src="../img/recursividade/lavar/9.png"></img>
            </div>
        </div>



        <div class="vidas">
            <div class="vidas1">
                <img src="../img/recursividade/cortar/vida.png"></img>
            </div>
            <div class="vidas2">
                <img src="../img/recursividade/cortar/vida.png"></img>
            </div>
            <div class="vidas3">
                <img src="../img/recursividade/cortar/vida.png"></img>
            </div>
        </div>







    </div>



    <script>


        var dx;
        var px;
        var vel;
        var temp;
        var personagem;

        function inicia() {
            dx = 0;
            px = 0;
            vel = 0.5;
            personagem = document.querySelector(".personagem");
            document.addEventListener('keydown', mover);
            document.addEventListener('keyup', soltar);
            personagem.style.left = px + "%";
            temp = setInterval(atualizaFrame, 18);
        }



        var vidas = 3;

        var wall = document.querySelector(".wall");   //projeta as ceramicas do cenario 

        for (var i = 0; i < 100; i++) {
            var tile = document.createElement("div");
            tile.className = "tile";
            wall.appendChild(tile);
        }


        var contadorCamisas = 1;
        var contadorSapatos = 1;
        var contadorVestidos = 1;
        var atualiza = 1;

        var controle = 0;

        var contador = 0;

        const personagemIniciado = (event) => {
            event.dataTransfer.setData("img", event.target.id);
        }

        const areaColisao = (event) => {
            event.preventDefault();
        }


        const alteraVida = () => {
            if (vidas == 3) {
                document.querySelector(".vidas3").remove();
                vidas = vidas - 1;
                return;
            } else if (vidas == 2) {
                document.querySelector(".vidas2").remove();
                vidas = vidas - 1;
                return;
            } else if (vidas == 1) {
                document.querySelector(".vidas1").remove();
                vidas = vidas - 1;
                return;
            } else if (vidas == 0) {
                exibeNotificação("error", "Você perdeu todas as vidas! Clique para tentar novamente!!", './funcoesLavadeira.html');
            }
        }
        const loop = setInterval(() => {

            var perso = document.getElementById("personagem");
            perso.getBoundingClientRect();

            //lacos for para detectar colisao com inimigos e roupas 
            if ((perso.x < m6.x + m6.width && perso.x + perso.width > m6.x && perso.y < m6.y + m6.height && perso.y + perso.height > m6.y)) {
                personagem.style.bottom = "1%";
                personagem.style.left = "0%";
                valor = "livre";
                px = 0;
                contador = contador - 1;
                alteraVida();
            }
         

            if ((perso.x < m7.x + m7.width && perso.x + perso.width > m7.x && perso.y < m7.y + m7.height && perso.y + perso.height > m7.y)) {
                personagem.style.bottom = "1%";
                personagem.style.left = "0%";
                valor = "livre";
                px = 0;
                contador = contador - 1;
                alteraVida();
            }

            if ((perso.x < m8.x + m8.width && perso.x + perso.width > m8.x && perso.y < m8.y + m8.height && perso.y + perso.height > m8.y)) {
                personagem.style.bottom = "1%";
                personagem.style.left = "0%";
                valor = "livre";
                px = 0;
                contador = contador - 1;
                alteraVida();
            }

            if ((perso.x < roupa.x + roupa.width && perso.x + perso.width > roupa.x && perso.y < roupa.y + roupa.height && perso.y + perso.height > roupa.y)) {
                if (atualiza == 9) {
                    personagem.style.display = "none";

                    exibeNotificação("success", "Você Coletou Todas as Peças! Vamos a Proxima Tarefa!", './funcoes.html?valor=1');
                }

                if ((roupa.src).includes("1.png") || (roupa.src).includes("4.png") || (roupa.src).includes("7.png")) {
                    document.getElementById("b" + contadorCamisas).style.backgroundColor = "green";
                    alteraAlimentos(0);
                }
                else if ((roupa.src).includes("2.png") || (roupa.src).includes("5.png") || (roupa.src).includes("8.png")) {
                    document.getElementById("s" + contadorSapatos).style.backgroundColor = "green";
                    alteraAlimentos(1);
                } else {
                    document.getElementById("v" + contadorVestidos).style.backgroundColor = "green";
                    alteraAlimentos(2);
                }

                if (atualiza == 3) {
                    document.getElementById("m8").style.display = "block";
                    document.querySelector(".m8").style.animationPlayState = "running";
                }

                if (atualiza == 6) {
                    document.getElementById("m6").style.display = "block";
                    document.querySelector(".m6").style.animationPlayState = "running";
                }
            }
        }, 50);

        const alteraAlimentos = (num) => {

            if (contadorCamisas == 5) {
                contadorCamisas = 0;
            };

            document.getElementById("roupa").src = "../img/recursividade/lavar/" + (atualiza + 1) + ".png";

            var locais = [
                { x: 20, y: 20 }, { x: 40, y: 20 }, { x: 60, y: 20 }, { x: 80, y: 20 },
                { x: 25, y: 45 }, { x: 35, y: 45 }, { x: 65, y: 45 }, { x: 75, y: 45 }, 
                { x: 20, y: 74 }, { x: 30, y: 74 }, { x: 55, y: 74 }, { x: 70, y: 74 }, 
                { x: 30, y: 90 }, { x: 55, y: 90 }, { x: 80, y: 90 } 
            ];

            var pontoEscolhido = locais[Math.floor(Math.random() * locais.length)];    //defini locais onde aparecerao os alimentos
            roupa.style.left = pontoEscolhido.x + '%';
            roupa.style.top = pontoEscolhido.y + '%';

            if (num == 0) {
                contadorCamisas = contadorCamisas + 1;
            } else if (num == 1) {
                contadorSapatos = contadorSapatos + 1;
            } else {
                contadorVestidos = contadorVestidos + 1;
            }
            atualiza = atualiza + 1;
        }

        listaEscada = [];
        valor = "livre";

        var entradaP = document.querySelector(".porta0");                //pega localizacao da porta da entrada da lavanderia 
        var localizacaoEntradaP = entradaP.getBoundingClientRect();
        var locEntrada = localizacaoEntradaP.left + window.pageXOffset;

        var entradaP2 = document.querySelector(".portaAberta1");                //pega localizacao da porta da entrada da lavanderia 
        var localizacaoEntradaP2 = entradaP2.getBoundingClientRect();
        var locEntrada2 = localizacaoEntradaP2.left + window.pageXOffset;

        //funcoes para mover personagem ao pressionar tecla designada

        
        const moverCima = () => {
            const value = getComputedStyle(personagem).getPropertyValue('bottom');
            var remove_string = value.replace('px', '');
            var valorNum = parseInt(remove_string);
            var numPx = valorNum + 10;
            var soma = parseInt(value) + 20;
            personagem.style.bottom = soma + "px";
        }

        const moverDireita = () => {
            dx = 1;
            document.getElementById("personagem").style.transform = "scaleX(1)";
        }

        const moverEsquerda = () => {
            dx = -1;
            document.getElementById("personagem").style.transform = "scaleX(-1)";
        }

        const mover = () => {
            var tecla = event.keyCode;


            //variaveis para capturar tecla e elementos presentes no cenario
            var chao = document.querySelector('.bloco4');
            var per = document.getElementById("personagem");
            var escadas = document.querySelectorAll("#escada1, #escada2, #escada3, #escada4, #escada5");

            for (var i = 0; i < escadas.length; i++) { //pega referencia da localizacao das escadas
                escadas[i].getBoundingClientRect();
            }

            //acessa os atributos das portas de teletransporte
            var portaAberta1 = document.getElementById("portaAberta1");
            var portaAberta2 = document.getElementById("portaAberta2");
            var portaAberta3 = document.getElementById("portaAberta3");

            per.getBoundingClientRect();
            portaAberta1.getBoundingClientRect();
            portaAberta2.getBoundingClientRect();
            portaAberta3.getBoundingClientRect();


            //verifica colisao com as portas de teletransporte e realiza a movimentacao do personagem
            if ((per.x < portaAberta1.x + portaAberta1.width && per.x + per.width > portaAberta1.x && per.y < portaAberta1.y + portaAberta1.height && per.y + per.height > portaAberta1.y) || (per.x < portaAberta2.x + portaAberta2.width && per.x + per.width > portaAberta2.x && per.y < portaAberta2.y + portaAberta2.height && per.y + per.height > portaAberta2.y) || (per.x < portaAberta3.x + portaAberta3.width && per.x + per.width > portaAberta3.x && per.y < portaAberta3.y + portaAberta3.height && per.y + per.height > portaAberta3.y)) {

                if (per.x + 100 > portaAberta2.x && per.x < 500) {
                    var teleport = "teleport1";
                } else if (per.x > portaAberta2.x) {
                    var teleport = "teleport3";
                } 



                setTimeout(function () {
                    personagem.style.bottom = "1%";
                    px = 0;
                    document.getElementById("teleport2").style.display = 'block';
                    document.getElementById(teleport).style.display = 'block';
                }, 500);

                setTimeout(function () {
                    document.getElementById("teleport2").style.display = 'none';
                    document.getElementById(teleport).style.display = 'none';
                }, 1000);
            }


            if (tecla == 39 && valor == "livre") {
                moverDireita();
            } else if (tecla == 37 && valor == "livre") {
                moverEsquerda();
            }

            else if (tecla == 38) { //realiza movimentacao para cima, caso esteja em cima de uma escada

                for (var i = 0; i < escadas.length; i++) {

                    if ((per.x + 30 < escadas[i].x + escadas[i].width && per.x - 30 + per.width > escadas[i].x) && (per.y < escadas[i].y + (-10) + escadas[i].height && per.y - (-10) + per.height > escadas[i].y)) {
                        valor = "bloqueado";
                        moverCima();
                    }

                    if (per.y + per.height <= escadas[i].y) {
                        valor = "livre";
                    }
                }
            }
        }

        const soltar = () => {
            var tecla = event.keyCode;
            if (tecla == 39) {
                dx = 0;
            }
            if (tecla == 37) {
                dx = 0;
            }
        }

        const atualizaFrame = () => {

            // Verifica se a nova posição está dentro dos limites
            if (px < 0) {
                px = 1;
            } else if (px > 90) {
                px = 89;
            } else {
                px += dx * vel;
                personagem.style.left = px + "%";
                personagem.style.right = px + "%";
            }
        }

        inicia();




        const voltar_menu = () => {
            var tecla = event.keyCode;


            if (tecla == 27) {
                window.location.href = './funcoes.html';
            }
        }
        document.addEventListener('keydown', voltar_menu);

    </script>
</body>

</html>
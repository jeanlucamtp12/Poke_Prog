<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="../sweetalert/sweetalert.js"></script>
    <script src="../telaInicial/dialogos.js"></script>
    <script src="./perguntas.js"></script>

    <link rel="stylesheet" href="../css/decisao.css">


    <title>Document</title>
</head>

<body>

    <audio id="audio" src="../sounds/decisao.mp3" loop autoplay></audio>


    <div class="arena">


        <div class="grass"></div>

        <img class="nuvens" src="../img/decisao/clouds.png">
        <img class="nuvens2" src="../img/decisao/clouds.png">


        <img class="jogador" src="../img/decisao/menino.png"> </img>

        <div>
            <img class="poke" src="../img/decisao/bulba.png">
            <img class="base" src="../img/decisao/base.png">

            <div class="barraVida" id="barraVida">
                <div id="barra1"></div>
                <div id="barra2"></div>
                <div id="barra3"></div>
                <div id="barra4"></div>
                <div id="barra5"></div>
            </div>
        </div>

        <div id="inimigo1" style="display: block;">
            <img class="pokeAdversario" src="../img/decisao/arbok.gif">
            <div id="barraVidaAdversario" class="barraVidaAdversario">
                <div id="barraA1"></div>
                <div id="barraA2"></div>
                <div id="barraA3"></div>
                <div id="barraA4"></div>
            </div>
            <img class="ataqueVeneno" id="ataqueVeneno" src="../img/decisao/ataqueVeneno.gif" style="display:none">
            </img>
            <img class="adversario" src="../img/decisao/adversario.png"> </img>
        </div>


        <div id="inimigo2" style="display: none;">
            <img class="pokeAdversario2" src="../img/decisao/jigglypuff.png">
            <img class="pokeAdversario3" src="../img/decisao/wigglytuff.png">
            <img class="base2" src="../img/decisao/base.png">
            <img class="base3" src="../img/decisao/base.png">
            <img class="adversario2" src="../img/decisao/treinador2.png">
            <img class="ataqueFada" id="ataqueFada" src="../img/decisao/ataqueJiggly.png" style="display:none"> </img>



            <div id="barraVidaAdversario2" class="barraVidaAdversario2">
                <div id="barraA2_1"></div>
                <div id="barraA2_2"></div>
                <div id="barraA2_3"></div>
                <div id="barraA2_4"></div>
            </div>

            <div id="barraVidaAdversario3" class="barraVidaAdversario3">
                <div id="barraA3_1"></div>
                <div id="barraA3_2"></div>
                <div id="barraA3_3"></div>
                <div id="barraA3_4"></div>
            </div>

        </div>


        <div id="inimigo4" style="display: none;">
            <img class="pokeAdversario4" src="../img/decisao/garchomp.png">
            <img class="base4" src="../img/decisao/base.png">
            <img class="adversario4" src="../img/decisao/cynthia.png">

            <img class="ataqueDragao" id="ataqueDragao" src="../img/decisao/ataqueDragao.gif" style="display:none">
            </img>



            <div id="barraVidaAdversario4" class="barraVidaAdversario4">
                <div id="barraA4_1"></div>
                <div id="barraA4_2"></div>
                <div id="barraA4_3"></div>
                <div id="barraA4_4"></div>
                <div id="barraA4_5"></div>
            </div>



        </div>




        <div>
            <h3 id="ajuda">Ajuda</h3>
            <img class="lampent" src="../img/decisao/lampent.png" onclick="abrirAjuda()" style="cursor: pointer;">
            </img>

            <div class="abrirAjuda" style="display: none;">
                <img id="imagemAjuda" src="../img/decisao/complemento.jpg"></img>
            </div>
        </div>



        <img class="ataqueGrama" id="ataqueGrama" src="../img/decisao/ataqueGrama.png" style="display:none"> </img>




        <div class="form" id="form" method="GET" enctype='multipart/form-data'>
            <form>
                <div>
                    <label id="nome" for="nome"></label><br> <br>
                    <button type="button" onclick="validaResposta(this.value)" id="resposta" value="" > </button>
                    <button type="button" onclick="validaResposta(this.value)" id="resposta2" value="" > </button>
                </div>
            </form>
        </div>


    </div>






</body>

</html>

<script>


    // Criar um vetor com números de 1 a 21
    var vetorPerguntas = Array.from({ length: 20 }, (_, index) => index + 0);
    // Embaralhar o vetor
    vetorPerguntas.sort(() => Math.random() - 0.5);

    var idPergunta = 0; //inicia id como 0 para pegar a primeira pergunta no vetor de perguntas
    carregarPergunta();

    function carregarPergunta() { //exibe as perguntas e respostas na tela do usuario
        document.getElementById("nome").innerText = perguntas[vetorPerguntas[idPergunta]].question;
        document.getElementById("resposta").innerText = perguntas[vetorPerguntas[idPergunta]].answers[0].option;
        document.getElementById("resposta2").innerText = perguntas[vetorPerguntas[idPergunta]].answers[1].option;
        document.getElementById("resposta").value = perguntas[vetorPerguntas[idPergunta]].answers[0].option;
        document.getElementById("resposta2").value = perguntas[vetorPerguntas[idPergunta]].answers[1].option;
    }

    //variaveis responsaveis por definir a vida do jogador e inimigos
    var vidaJ = 5;
    var vidaI1 = 4;
    var vidaI2 = 4;
    var vidaI4 = 5;
    var popUp = "false";

    for (var i = 1, j = 0; j <= 100; i++) {  //laço for para projetar os matinhos presentes no chão do cenario
        var img = document.createElement('img');
        img.src = '../img/decisao/mato.png';
        img.classList.add('mato');
        img.id = 'mato' + i;
        img.style.bottom = "0%";
        img.style.width = "4%";
        img.style.left = j + "%";
        var body = document.querySelector("body");
        j = j + 3.8;
        body.appendChild(img);
    }

    var i = 1;
    var jogador = 0; //variaveis usadas para verificar quem está ganhando, o jogador ou a maquina
    var adversario = 0;


    const realizaAtaque = (resposta) => {  //realiza os ataques de acordo com as respostas informadas
        if (resposta == "grama") {
            document.getElementById("ataqueGrama").style.display = "block";
            setTimeout(function () {
                pararAnimacao(1)
            }, 600);
        } else {
            if (vidaI1 == 0 && vidaI2 > 0) {
                document.getElementById("ataqueFada").style.display = "block";
                setTimeout(function () {
                    pararAnimacao(2)
                }, 1100);
            } else if (vidaI1 == 0 && vidaI2 == 0) {
                document.getElementById("ataqueDragao").style.display = "block";
                setTimeout(function () {
                    pararAnimacao(3)
                }, 1100);
            }
            else {
                document.getElementById("ataqueVeneno").style.display = "block";
                setTimeout(function () {
                    pararAnimacao(4)
                }, 1000);
            }
        }
    }


    function validaResposta(resposta) { //valida as respostas informadas pelo usuario
        if ((perguntas[vetorPerguntas[idPergunta]].answers[0].correct == true && resposta == perguntas[vetorPerguntas[idPergunta]].answers[0].option) || perguntas[vetorPerguntas[idPergunta]].answers[1].correct == true && resposta == perguntas[vetorPerguntas[idPergunta]].answers[1].option) {
            realizaAtaque("grama");
            jogador = jogador + 1;
        } else {
            realizaAtaque("veneno");
            adversario = adversario + 1;
        }

        idPergunta = idPergunta + 1;
        carregarPergunta(idPergunta);

        if (jogador == 13) { // caso a variavel jogador seja igual a 13, indica que ele venceu
                setInterval(function () {
                    if(popUp == "false"){
                        document.querySelector(".pokeAdversario4").style.display = "none";

                        exibeNotificação("success", "Você concluiu a fase! Vamos as perguntas da fase!", '../Quizes/quizEntreFases.html?fase=2');
                        popUp = "true";
                    }
                }, 2000);

            } else if (adversario == 5) { // se o adversario conseguir desferir 5 ataques ao jogador, indica que o jogador perdeu
                setInterval(function () {
                    if(popUp == "false"){

                        exibeNotificação("error", "Você perdeu! Clique para tentar novamente!", './decisao.html');
                        popUp = "true";
                    }
                }, 2000);
            }

    }




    const pararAnimacao = (id) => { //funcao para para a animação dos ataques e reduzir vida pontos de vida

        if (id == 1) {

            document.getElementById("ataqueGrama").style.display = "none";

            if (vidaI1 == 0 && vidaI2 > 0) {
                document.getElementById("barraA2_" + vidaI2).remove();
                document.getElementById("barraA3_" + vidaI2).remove();
                vidaI2 = vidaI2 - 1;

            } else if (vidaI1 == 0 && vidaI2 == 0) {
                document.getElementById("barraA4_" + vidaI4).remove();
                vidaI4 = vidaI4 - 1;
            }
            else {
                document.getElementById("barraA" + vidaI1).remove();
                vidaI1 = vidaI1 - 1;
            }

            if (vidaI1 == 0 && vidaI2 > 0) {

                setInterval(function () {
                    if (vidaI2 == 4) {
                        document.querySelector("#inimigo1").style.display = "none";
                        document.querySelector("#inimigo2").style.display = "block";
                        document.body.style.background = 'linear-gradient(#9c26e0, #98c6ac) no-repeat';
                    }
                }, 1000);
            }

            if (vidaI2 == 0 && vidaI4 == 5) {
                setInterval(function () {
                    document.querySelector("#inimigo2").style.display = "none";
                    document.querySelector("#inimigo4").style.display = "block";
                    document.body.style.background = 'linear-gradient(#000000, #5d7c6b) no-repeat';
                }, 1000);
                document.querySelector("#audio").src = "../sounds/cynthia.mp3"
            }

        } else if (id == 4) {
            document.getElementById("ataqueVeneno").style.display = "none";
            document.getElementById("barra" + vidaJ).remove();
            vidaJ = vidaJ - 1;

        } else if (id == 2) {
            document.getElementById("ataqueFada").style.display = "none";
            document.getElementById("barra" + vidaJ).remove();
            vidaJ = vidaJ - 1;
        } else {
            document.getElementById("ataqueDragao").style.display = "none";
            document.getElementById("barra" + vidaJ).remove();
            vidaJ = vidaJ - 1;
        }
    }

    const abrirAjuda = () => { //abri e fecha guia de ajuda, caso jogador solicite

        if (document.querySelector(".abrirAjuda").style.display == "block") {
            document.querySelector(".abrirAjuda").style.display = "none";
        } else {
            document.querySelector(".abrirAjuda").style.display = "block"
        }
    }


    const voltar_menu = () => { //funcao para verificar se o usuario clicou na tecla 'Esc' para retornar ao menu de fases
        var tecla = event.keyCode;


        if (tecla == 27) {
            window.location.href = '../telaInicial/city.html';
        }
    }
    document.addEventListener('keydown', voltar_menu);
</script>